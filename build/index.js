// @bun
var Lf=class{},a=class extends Lf{};var e=(f)=>{const J=f.split("/");if(J[0]==="")J.shift();return J},ff=(f)=>{const J=[];for(let $=0;;){let z=!1;if(f=f.replace(/\{[^}]+\}/g,(Y)=>{const Q=`@\\${$}`;return J[$]=[Q,Y],$++,z=!0,Q}),!z)break}const Z=f.split("/");if(Z[0]==="")Z.shift();for(let $=J.length-1;$>=0;$--){const[z]=J[$];for(let Y=Z.length-1;Y>=0;Y--)if(Z[Y].indexOf(z)!==-1){Z[Y]=Z[Y].replace(z,J[$][1]);break}}return Z},b={},$f=(f)=>{if(f==="*")return"*";const J=f.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(J){if(!b[f])if(J[2])b[f]=[f,J[1],new RegExp("^"+J[2]+"$")];else b[f]=[f,J[1],!0];return b[f]}return null},c=(f)=>{const J=f.url.match(/^https?:\/\/[^/]+(\/[^?]*)/);return J?J[1]:""},Jf=(f)=>{const J=f.indexOf("?",8);return J===-1?"":"?"+f.slice(J+1)},Zf=(f)=>{const J=c(f);return J.length>1&&J[J.length-1]==="/"?J.slice(0,-1):J},O=(...f)=>{let J="",Z=!1;for(let $ of f){if(J[J.length-1]==="/")J=J.slice(0,-1),Z=!0;if($[0]!=="/")$=`/${$}`;if($==="/"&&Z)J=`${J}/`;else if($!=="/")J=`${J}${$}`;if($==="/"&&J==="")J="/"}return J},R=(f)=>{const J=f.match(/^(.+|)(\/\:[^\/]+)\?$/);if(!J)return null;const Z=J[1],$=Z+J[2];return[Z===""?"/":Z.replace(/\/$/,""),$]},k=(f)=>{if(!/[%+]/.test(f))return f;if(f.indexOf("+")!==-1)f=f.replace(/\+/g," ");return/%/.test(f)?w(f):f},zf=(f,J,Z)=>{let $;if(!Z&&J&&!/[%+]/.test(J)){let Q=f.indexOf(`?${J}`,8);if(Q===-1)Q=f.indexOf(`&${J}`,8);while(Q!==-1){const V=f.charCodeAt(Q+J.length+1);if(V===61){const U=Q+J.length+2,F=f.indexOf("&",U);return k(f.slice(U,F===-1?void 0:F))}else if(V==38||isNaN(V))return"";Q=f.indexOf(`&${J}`,Q+1)}if($=/[%+]/.test(f),!$)return}const z={};$??($=/[%+]/.test(f));let Y=f.indexOf("?",8);while(Y!==-1){const Q=f.indexOf("&",Y+1);let V=f.indexOf("=",Y);if(V>Q&&Q!==-1)V=-1;let U=f.slice(Y+1,V===-1?Q===-1?void 0:Q:V);if($)U=k(U);if(Y=Q,U==="")continue;let F;if(V===-1)F="";else if(F=f.slice(V+1,Q===-1?void 0:Q),$)F=k(F);if(Z)(z[U]??(z[U]=[])).push(F);else z[U]??(z[U]=F)}return J?z[J]:z},Yf=zf,Qf=(f,J)=>{return zf(f,J,!0)},w=decodeURIComponent;var Mf=/^[\w!#$%&'*.^`|~+-]+$/,jf=/^[ !#-:<-[\]-~]*$/,Ff=(f,J)=>{return f.trim().split(";").reduce(($,z)=>{z=z.trim();const Y=z.indexOf("=");if(Y===-1)return $;const Q=z.substring(0,Y).trim();if(J&&J!==Q||!Mf.test(Q))return $;let V=z.substring(Y+1).trim();if(V.startsWith('"')&&V.endsWith('"'))V=V.slice(1,-1);if(jf.test(V))$[Q]=w(V);return $},{})};var Nf=(f,J,Z={})=>{let $=`${f}=${J}`;if(Z&&typeof Z.maxAge==="number"&&Z.maxAge>=0)$+=`; Max-Age=${Math.floor(Z.maxAge)}`;if(Z.domain)$+=`; Domain=${Z.domain}`;if(Z.path)$+=`; Path=${Z.path}`;if(Z.expires)$+=`; Expires=${Z.expires.toUTCString()}`;if(Z.httpOnly)$+="; HttpOnly";if(Z.secure)$+="; Secure";if(Z.sameSite)$+=`; SameSite=${Z.sameSite}`;if(Z.partitioned)$+="; Partitioned";return $},Vf=(f,J,Z={})=>{return J=encodeURIComponent(J),Nf(f,J,Z)};var Uf=class{constructor(f){this.writable=f,this.writer=f.getWriter(),this.encoder=new TextEncoder}async write(f){try{if(typeof f==="string")f=this.encoder.encode(f);await this.writer.write(f)}catch(J){}return this}async writeln(f){return await this.write(f+"\n"),this}sleep(f){return new Promise((J)=>setTimeout(J,f))}async close(){try{await this.writer.close()}catch(f){}}async pipe(f){this.writer.releaseLock(),await f.pipeTo(this.writable,{preventClose:!0}),this.writer=this.writable.getWriter()}};var Kf="text/plain; charset=UTF-8",T=class{constructor(f,J){if(this.env={},this._var={},this.finalized=!1,this.error=void 0,this._status=200,this._h=void 0,this._pH=void 0,this._init=!0,this._renderer=(Z)=>this.html(Z),this.notFoundHandler=()=>new Response,this.render=(...Z)=>this._renderer(...Z),this.setRenderer=(Z)=>{this._renderer=Z},this.header=(Z,$,z)=>{if($===void 0){if(this._h)this._h.delete(Z);else if(this._pH)delete this._pH[Z.toLocaleLowerCase()];if(this.finalized)this.res.headers.delete(Z);return}if(z?.append){if(!this._h)this._init=!1,this._h=new Headers(this._pH),this._pH={};this._h.append(Z,$)}else if(this._h)this._h.set(Z,$);else this._pH??(this._pH={}),this._pH[Z.toLowerCase()]=$;if(this.finalized)if(z?.append)this.res.headers.append(Z,$);else this.res.headers.set(Z,$)},this.status=(Z)=>{this._status=Z},this.set=(Z,$)=>{this._var??(this._var={}),this._var[Z]=$},this.get=(Z)=>{return this._var?this._var[Z]:void 0},this.newResponse=(Z,$,z)=>{if(this._init&&!z&&!$&&this._status===200)return new Response(Z,{headers:this._pH});if($&&typeof $!=="number"){const Q=new Response(Z,$),V=this._pH?.["content-type"];if(V)Q.headers.set("content-type",V);return Q}const Y=$??this._status;this._pH??(this._pH={}),this._h??(this._h=new Headers);for(let[Q,V]of Object.entries(this._pH))this._h.set(Q,V);if(this._res){this._res.headers.forEach((Q,V)=>{this._h?.set(V,Q)});for(let[Q,V]of Object.entries(this._pH))this._h.set(Q,V)}z??(z={});for(let[Q,V]of Object.entries(z))if(typeof V==="string")this._h.set(Q,V);else{this._h.delete(Q);for(let U of V)this._h.append(Q,U)}return new Response(Z,{status:Y,headers:this._h})},this.body=(Z,$,z)=>{return typeof $==="number"?this.newResponse(Z,$,z):this.newResponse(Z,$)},this.text=(Z,$,z)=>{if(!this._pH){if(this._init&&!z&&!$)return new Response(Z);this._pH={}}if(this._pH["content-type"])this._pH["content-type"]=Kf;return typeof $==="number"?this.newResponse(Z,$,z):this.newResponse(Z,$)},this.json=(Z,$,z)=>{const Y=JSON.stringify(Z);return this._pH??(this._pH={}),this._pH["content-type"]="application/json; charset=UTF-8",typeof $==="number"?this.newResponse(Y,$,z):this.newResponse(Y,$)},this.jsonT=(Z,$,z)=>{const Y=typeof $==="number"?this.json(Z,$,z):this.json(Z,$);return{response:Y,data:Z,format:"json",status:Y.status}},this.html=(Z,$,z)=>{return this._pH??(this._pH={}),this._pH["content-type"]="text/html; charset=UTF-8",typeof $==="number"?this.newResponse(Z,$,z):this.newResponse(Z,$)},this.redirect=(Z,$=302)=>{return this._h??(this._h=new Headers),this._h.set("Location",Z),this.newResponse(null,$)},this.streamText=(Z,$,z)=>{return z??(z={}),this.header("content-type",Kf),this.header("x-content-type-options","nosniff"),this.header("transfer-encoding","chunked"),this.stream(Z,$,z)},this.stream=(Z,$,z)=>{const{readable:Y,writable:Q}=new TransformStream,V=new Uf(Q);return Z(V).finally(()=>V.close()),typeof $==="number"?this.newResponse(Y,$,z):this.newResponse(Y,$)},this.cookie=(Z,$,z)=>{const Y=Vf(Z,$,z);this.header("set-cookie",Y,{append:!0})},this.notFound=()=>{return this.notFoundHandler(this)},this.req=f,J){if(this._exCtx=J.executionCtx,this.env=J.env,J.notFoundHandler)this.notFoundHandler=J.notFoundHandler}}get event(){if(this._exCtx instanceof a)return this._exCtx;else throw Error("This context has no FetchEvent")}get executionCtx(){if(this._exCtx)return this._exCtx;else throw Error("This context has no ExecutionContext")}get res(){return this._init=!1,this._res||(this._res=new Response("404 Not Found",{status:404}))}set res(f){if(this._init=!1,this._res&&f)this._res.headers.delete("content-type"),this._res.headers.forEach((J,Z)=>{f.headers.set(Z,J)});this._res=f,this.finalized=!0}get var(){return{...this._var}}get runtime(){const f=globalThis;if(f?.Deno!==void 0)return"deno";if(f?.Bun!==void 0)return"bun";if(typeof f?.WebSocketPair==="function")return"workerd";if(typeof f?.EdgeRuntime==="string")return"edge-light";if(f?.fastly!==void 0)return"fastly";if(f?.__lagon__!==void 0)return"lagon";if(f?.process?.release?.name==="node")return"node";return"other"}};var u=(f,J,Z)=>{const $=f.length;return(z,Y)=>{let Q=-1;return V(0);function V(U){if(U<=Q)throw new Error("next() called multiple times");let F=f[U];if(Q=U,U===$&&Y)F=Y;let K,B=!1;if(!F){if(z instanceof T&&z.finalized===!1&&Z)K=Z(z)}else try{K=F(z,()=>{const G=V(U+1);return G instanceof Promise?G:Promise.resolve(G)})}catch(G){if(G instanceof Error&&z instanceof T&&J)z.error=G,K=J(G,z),B=!0;else throw G}if(!(K instanceof Promise)){if(K!==void 0&&("response"in K))K=K.response;if(K&&(z.finalized===!1||B))z.res=K;return z}else return K.then((G)=>{if(G!==void 0&&("response"in G))G=G.response;if(G&&z.finalized===!1)z.res=G;return z}).catch(async(G)=>{if(G instanceof Error&&z instanceof T&&J)return z.error=G,z.res=await J(G,z),z;throw G})}}};var Gf=class extends Error{constructor(f=500,J){super(J?.message);this.res=J?.res,this.status=f}getResponse(){if(this.res)return this.res;return new Response(this.message,{status:this.status})}};var Bf=async(f)=>{let J={};const Z=f.headers.get("Content-Type");if(Z&&(Z.startsWith("multipart/form-data")||Z.startsWith("application/x-www-form-urlencoded"))){const $=await f.formData();if($){const z={};$.forEach((Y,Q)=>{if(Q.slice(-2)==="[]"){if(!z[Q])z[Q]=[Y.toString()];else if(Array.isArray(z[Q]))z[Q].push(Y.toString())}else z[Q]=Y}),J=z}}return J};var Xf=class{constructor(f,J="/",Z){this.bodyCache={},this.cachedBody=($)=>{const{bodyCache:z,raw:Y}=this,Q=z[$];if(Q)return Q;if(z.arrayBuffer)return(async()=>{return await new Response(z.arrayBuffer)[$]()})();return z[$]=Y[$]()},this.raw=f,this.path=J,this.paramData=Z,this.vData={}}param(f){if(this.paramData)if(f){const J=this.paramData[f];return J?/\%/.test(J)?w(J):J:void 0}else{const J={};for(let[Z,$]of Object.entries(this.paramData))if($&&typeof $==="string")J[Z]=/\%/.test($)?w($):$;return J}return null}query(f){return Yf(this.url,f)}queries(f){return Qf(this.url,f)}header(f){if(f)return this.raw.headers.get(f.toLowerCase())??void 0;const J={};return this.raw.headers.forEach((Z,$)=>{J[$]=Z}),J}cookie(f){const J=this.raw.headers.get("Cookie");if(!J)return;const Z=Ff(J);if(f)return Z[f];else return Z}async parseBody(){if(this.bodyCache.parsedBody)return this.bodyCache.parsedBody;const f=await Bf(this);return this.bodyCache.parsedBody=f,f}json(){return this.cachedBody("json")}text(){return this.cachedBody("text")}arrayBuffer(){return this.cachedBody("arrayBuffer")}blob(){return this.cachedBody("blob")}formData(){return this.cachedBody("formData")}addValidatedData(f,J){this.vData[f]=J}valid(f){return this.vData[f]}get url(){return this.raw.url}get method(){return this.raw.method}get headers(){return this.raw.headers}get body(){return this.raw.body}get bodyUsed(){return this.raw.bodyUsed}get integrity(){return this.raw.integrity}get keepalive(){return this.raw.keepalive}get referrer(){return this.raw.referrer}get signal(){return this.raw.signal}};var X="ALL",Wf="all",_=["get","post","put","delete","options","patch"],E=class extends Error{};var Pf=function(){return class{}},Sf=(f)=>{return f.text("404 Not Found",404)},Hf=(f,J)=>{if(f instanceof Gf)return f.getResponse();console.trace(f);const Z="Internal Server Error";return J.text(Z,500)},i=class extends Pf(){constructor(f={}){super();this._basePath="/",this.path="/",this.routes=[],this.notFoundHandler=Sf,this.errorHandler=Hf,this.head=()=>{return console.warn("`app.head()` is no longer used. `app.get()` implicitly handles the HEAD method."),this},this.handleEvent=($)=>{return this.dispatch($.request,$,void 0,$.request.method)},this.fetch=($,z,Y)=>{return this.dispatch($,Y,z,$.method)},this.request=($,z,Y,Q)=>{if($ instanceof Request){if(z!==void 0)$=new Request($,z);return this.fetch($,Y,Q)}$=$.toString();const V=/^https?:\/\//.test($)?$:`http://localhost${O("/",$)}`,U=new Request(V,z);return this.fetch(U,Y,Q)},this.fire=()=>{addEventListener("fetch",($)=>{$.respondWith(this.dispatch($.request,$,void 0,$.request.method))})},[..._,Wf].map(($)=>{this[$]=(z,...Y)=>{if(typeof z==="string")this.path=z;else this.addRoute($,this.path,z);return Y.map((Q)=>{if(typeof Q!=="string")this.addRoute($,this.path,Q)}),this}}),this.on=($,z,...Y)=>{if(!$)return this;this.path=z;for(let Q of[$].flat())Y.map((V)=>{this.addRoute(Q.toUpperCase(),this.path,V)});return this},this.use=($,...z)=>{if(typeof $==="string")this.path=$;else z.unshift($);return z.map((Y)=>{this.addRoute(X,this.path,Y)}),this};const Z=f.strict??!0;delete f.strict,Object.assign(this,f),this.getPath=Z?f.getPath??c:Zf}clone(){const f=new i({router:this.router,getPath:this.getPath});return f.routes=this.routes,f}route(f,J){const Z=this.basePath(f);if(!J)return Z;return J.routes.map(($)=>{const z=J.errorHandler===Hf?$.handler:async(Y,Q)=>(await u([$.handler],J.errorHandler)(Y,Q)).res;Z.addRoute($.method,$.path,z)}),this}basePath(f){const J=this.clone();return J._basePath=O(this._basePath,f),J}onError(f){return this.errorHandler=f,this}notFound(f){return this.notFoundHandler=f,this}showRoutes(){this.routes.map((J)=>{console.log(`\x1B[32m${J.method}\x1B[0m ${" ".repeat(8-J.method.length)} ${J.path}`)})}mount(f,J,Z){const $=O(this._basePath,f),z=$==="/"?0:$.length,Y=async(Q,V)=>{let U=void 0;try{U=Q.executionCtx}catch{}const F=Z?Z(Q):[Q.env,U],K=Array.isArray(F)?F:[F],B=Jf(Q.req.url),G=await J(new Request(new URL((Q.req.path.slice(z)||"/")+B,Q.req.url),Q.req.raw),...K);if(G)return G;await V()};return this.addRoute(X,O(f,"*"),Y),this}get routerName(){return this.matchRoute("GET","/"),this.router.name}addRoute(f,J,Z){if(f=f.toUpperCase(),this._basePath)J=O(this._basePath,J);this.router.add(f,J,Z);const $={path:J,method:f,handler:Z};this.routes.push($)}matchRoute(f,J){return this.router.match(f,J)||{handlers:[],params:{}}}handleError(f,J){if(f instanceof Error)return this.errorHandler(f,J);throw f}dispatch(f,J,Z,$){if($==="HEAD")return(async()=>new Response(null,await this.dispatch(f,J,Z,"GET")))();const z=this.getPath(f,{env:Z}),{handlers:Y,params:Q}=this.matchRoute($,z),V=new T(new Xf(f,z,Q),{env:Z,executionCtx:J,notFoundHandler:this.notFoundHandler});if(Y.length===1){let F;try{if(F=Y[0](V,async()=>{}),!F)return this.notFoundHandler(V)}catch(K){return this.handleError(K,V)}if(F instanceof Response)return F;if("response"in F)F=F.response;if(F instanceof Response)return F;return(async()=>{let K;try{if(K=await F,K!==void 0&&("response"in K))K=K.response;if(!K)return this.notFoundHandler(V)}catch(B){return this.handleError(B,V)}return K})()}const U=u(Y,this.errorHandler,this.notFoundHandler);return(async()=>{try{const F=U(V),K=F.constructor.name==="Promise"?await F:F;if(!K.finalized)throw new Error("Context is not finalized. You may forget returning Response object or `await next()`");return K.res}catch(F){return this.handleError(F,V)}})()}};var If=function(f,J){if(f.length===1)return J.length===1?f<J?-1:1:-1;if(J.length===1)return 1;if(f===N||f===P)return 1;else if(J===N||J===P)return-1;if(f===v)return 1;else if(J===v)return-1;return f.length===J.length?f<J?-1:1:J.length-f.length},v="[^/]+",N=".*",P="(?:|/.*)",S=Symbol(),y=class{constructor(){this.children={}}insert(f,J,Z,$,z){if(f.length===0){if(this.index!==void 0)throw S;if(z)return;this.index=J;return}const[Y,...Q]=f,V=Y==="*"?Q.length===0?["","",N]:["","",v]:Y==="/*"?["","",P]:Y.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);let U;if(V){const F=V[1],K=V[2]||v;if(U=this.children[K],!U){if(Object.keys(this.children).some((B)=>B!==N&&B!==P))throw S;if(z)return;if(U=this.children[K]=new y,F!=="")U.varIndex=$.varIndex++}if(!z&&F!==""){if(Z.some((B)=>B[0]===F))throw new Error("Duplicate param name");Z.push([F,U.varIndex])}}else if(U=this.children[Y],!U){if(Object.keys(this.children).some((F)=>F.length>1&&F!==N&&F!==P))throw S;if(z)return;U=this.children[Y]=new y}U.insert(Q,J,Z,$,z)}buildRegExpStr(){const J=Object.keys(this.children).sort(If).map((Z)=>{const $=this.children[Z];return(typeof $.varIndex==="number"?`(${Z})@${$.varIndex}`:Z)+$.buildRegExpStr()});if(typeof this.index==="number")J.unshift(`#${this.index}`);if(J.length===0)return"";if(J.length===1)return J[0];return"(?:"+J.join("|")+")"}};var qf=class{constructor(){this.context={varIndex:0},this.root=new y}insert(f,J,Z){const $=[],z=[];for(let Q=0;;){let V=!1;if(f=f.replace(/\{[^}]+\}/g,(U)=>{const F=`@\\${Q}`;return z[Q]=[F,U],Q++,V=!0,F}),!V)break}const Y=f.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let Q=z.length-1;Q>=0;Q--){const[V]=z[Q];for(let U=Y.length-1;U>=0;U--)if(Y[U].indexOf(V)!==-1){Y[U]=Y[U].replace(V,z[Q][1]);break}}return this.root.insert(Y,J,$,this.context,Z),$}buildRegExp(){let f=this.root.buildRegExpStr();if(f==="")return[/^$/,[],[]];let J=0;const Z=[],$=[];return f=f.replace(/#(\d+)|@(\d+)|\.\*\$/g,(z,Y,Q)=>{if(typeof Y!=="undefined")return Z[++J]=Number(Y),"$()";if(typeof Q!=="undefined")return $[Number(Q)]=++J,"";return""}),[new RegExp(`^${f}`),Z,$]}};var Of=function(f){return l[f]??(l[f]=new RegExp(f==="*"?"":`^${f.replace(/\/\*/,"(?:|/.*)")}\$`))},bf=function(){l={}},Rf=function(f){const J=new qf,Z=[];if(f.length===0)return Cf;const $=f.map((F)=>[!/\*|\/:/.test(F[0]),...F]).sort(([F,K],[B,G])=>F?1:B?-1:K.length-G.length),z={};for(let F=0,K=-1,B=$.length;F<B;F++){const[G,W,H]=$[F];if(G)z[W]={handlers:H,params:Df};else K++;let q;try{q=J.insert(W,K,G)}catch(I){throw I===S?new E(W):I}if(G)continue;Z[K]=q.length===0?[{handlers:H,params:Df},null]:[H,q]}const[Y,Q,V]=J.buildRegExp();for(let F=0,K=Z.length;F<K;F++){const B=Z[F][1];if(B)for(let G=0,W=B.length;G<W;G++)B[G][1]=V[B[G][1]]}const U=[];for(let F in Q)U[F]=Z[Q[F]];return[Y,U,z]},A=function(f,J){if(!f)return;for(let Z of Object.keys(f).sort(($,z)=>z.length-$.length))if(Of(Z).test(J))return[...f[Z]];return},m=[X,..._].map((f)=>f.toUpperCase()),Df={},Cf=[/^$/,[],{}],l={},s=class{constructor(){this.name="RegExpRouter",this.middleware={[X]:{}},this.routes={[X]:{}}}add(f,J,Z){var $;const{middleware:z,routes:Y}=this;if(!z||!Y)throw new Error("Can not add a route since the matcher is already built.");if(m.indexOf(f)===-1)m.push(f);if(!z[f])[z,Y].forEach((V)=>{V[f]={},Object.keys(V[X]).forEach((U)=>{V[f][U]=[...V[X][U]]})});if(J==="/*")J="*";if(/\*$/.test(J)){const V=Of(J);if(f===X)Object.keys(z).forEach((U)=>{var F;(F=z[U])[J]||(F[J]=A(z[U],J)||A(z[X],J)||[])});else($=z[f])[J]||($[J]=A(z[f],J)||A(z[X],J)||[]);Object.keys(z).forEach((U)=>{if(f===X||f===U)Object.keys(z[U]).forEach((F)=>{V.test(F)&&z[U][F].push(Z)})}),Object.keys(Y).forEach((U)=>{if(f===X||f===U)Object.keys(Y[U]).forEach((F)=>V.test(F)&&Y[U][F].push(Z))});return}const Q=R(J)||[J];for(let V=0,U=Q.length;V<U;V++){const F=Q[V];Object.keys(Y).forEach((K)=>{var B;if(f===X||f===K)(B=Y[K])[F]||(B[F]=[...A(z[K],F)||A(z[X],F)||[]]),Y[K][F].push(Z)})}}match(f,J){bf();const Z=this.buildAllMatchers();return this.match=($,z)=>{const Y=Z[$],Q=Y[2][z];if(Q)return Q;const V=z.match(Y[0]);if(!V)return null;const U=V.indexOf("",1),[F,K]=Y[1][U];if(!K)return F;const B={};for(let G=0,W=K.length;G<W;G++)B[K[G][0]]=V[K[G][1]];return{handlers:F,params:B}},this.match(f,J)}buildAllMatchers(){const f={};return m.forEach((J)=>{f[J]=this.buildMatcher(J)||f[X]}),this.middleware=this.routes=void 0,f}buildMatcher(f){const J=[];let Z=f===X;if([this.middleware,this.routes].forEach(($)=>{const z=$[f]?Object.keys($[f]).map((Y)=>[Y,$[f][Y]]):[];if(z.length!==0)Z||(Z=!0),J.push(...z);else if(f!==X)J.push(...Object.keys($[X]).map((Y)=>[Y,$[X][Y]]))}),!Z)return null;else return Rf(J)}};var h=class{constructor(f){this.name="SmartRouter",this.routers=[],this.routes=[],Object.assign(this,f)}add(f,J,Z){if(!this.routes)throw new Error("Can not add a route since the matcher is already built.");this.routes.push([f,J,Z])}match(f,J){if(!this.routes)throw new Error("Fatal error");const{routers:Z,routes:$}=this,z=Z.length;let Y=0,Q;for(;Y<z;Y++){const V=Z[Y];try{$.forEach((U)=>{V.add(...U)}),Q=V.match(f,J)}catch(U){if(U instanceof E)continue;throw U}this.match=V.match.bind(V),this.routers=[V],this.routes=void 0;break}if(Y===z)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,Q||null}get activeRouter(){if(this.routes||this.routers.length!==1)throw new Error("No active router has been determined yet.");return this.routers[0]}};var wf=function(f,J){for(let $=0,z=f.patterns.length;$<z;$++)if(typeof f.patterns[$]==="object"&&f.patterns[$][1]===J)return!0;const Z=Object.values(f.children);for(let $=0,z=Z.length;$<z;$++)if(wf(Z[$],J))return!0;return!1},p=class{constructor(f,J,Z){if(this.order=0,this.children=Z||{},this.methods=[],this.name="",f&&J){const $={};$[f]={handler:J,score:0,name:this.name},this.methods=[$]}this.patterns=[],this.handlerSetCache={}}insert(f,J,Z){this.name=`${f} ${J}`,this.order=++this.order;let $=this;const z=ff(J),Y=[],Q=(F)=>{return`Duplicate param name, use another name instead of '${F}' - ${f} ${J} <--- '${F}'`};for(let F=0,K=z.length;F<K;F++){const B=z[F];if(Object.keys($.children).includes(B)){Y.push(...$.patterns),$=$.children[B];continue}$.children[B]=new p;const G=$f(B);if(G){if(typeof G==="object"){for(let W=0,H=Y.length;W<H;W++)if(typeof Y[W]==="object"&&Y[W][1]===G[1])throw new Error(Q(G[1]));if(Object.values($.children).some((W)=>wf(W,G[1])))throw new Error(Q(G[1]))}$.patterns.push(G),Y.push(...$.patterns)}Y.push(...$.patterns),$=$.children[B]}if(!$.methods.length)$.methods=[];const V={},U={handler:Z,name:this.name,score:this.order};return V[f]=U,$.methods.push(V),$}gHSets(f,J,Z){var $,z;return($=f.handlerSetCache)[z=`${J}:${Z?"1":"0"}`]||($[z]=(()=>{const Y=[];for(let Q=0,V=f.methods.length;Q<V;Q++){const U=f.methods[Q],F=U[J]||U[X];if(F!==void 0)Y.push(F)}return Y})())}search(f,J){const Z=[],$={};let Y=[this];const Q=e(J);for(let F=0,K=Q.length;F<K;F++){const B=Q[F],G=F===K-1,W=[];let H=!1;for(let q=0,I=Y.length;q<I;q++){const D=Y[q],L=D.children[B];if(L)if(G===!0){if(L.children["*"])Z.push(...this.gHSets(L.children["*"],f,!0));Z.push(...this.gHSets(L,f)),H=!0}else W.push(L);for(let x=0,Af=D.patterns.length;x<Af;x++){const o=D.patterns[x];if(o==="*"){const g=D.children["*"];if(g)Z.push(...this.gHSets(g,f)),W.push(g);continue}if(B==="")continue;const[r,C,M]=o,j=D.children[r],t=Q.slice(F).join("/");if(M instanceof RegExp&&M.test(t)){Z.push(...this.gHSets(j,f)),$[C]=t;continue}if(M===!0||M instanceof RegExp&&M.test(B)){if(typeof r==="string")if(G===!0){if(Z.push(...this.gHSets(j,f)),j.children["*"])Z.push(...this.gHSets(j.children["*"],f))}else W.push(j);if(typeof C==="string"&&!H)$[C]=B;else if(D.children[B])$[C]=B}}}Y=W}const V=Z.length;if(V===0)return null;if(V===1)return{handlers:[Z[0].handler],params:$};return{handlers:Z.sort((F,K)=>{return F.score-K.score}).map((F)=>{return F.handler}),params:$}}};var d=class{constructor(){this.name="TrieRouter",this.node=new p}add(f,J,Z){const $=R(J);if($){for(let z of $)this.node.insert(f,z,Z);return}this.node.insert(f,J,Z)}match(f,J){return this.node.search(f,J)}};var n=class extends i{constructor(f={}){super(f);this.router=f.router??new h({routers:[new s,new d]})}};var Tf=new n;Tf.get("/",(f)=>f.text("Hono!")).get("/hello/:name",(f)=>f.text(`Hello ${f.req.param.name}!`));var t1=Tf;export{t1 as default};
